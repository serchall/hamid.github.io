# ุณุณุชู ุงุญุฑุงุฒ ููุช ุฏู ูุฑุญููโุง (2FA)

## ๐ ููุฑุณุช ูุทุงูุจ
- [ูุนุฑู](#ูุนุฑู)
- [ูฺฺฏโูุง](#ูฺฺฏูุง)
- [ูุญูู ฺฉุงุฑ](#ูุญูู-ฺฉุงุฑ)
- [ูุตุจ ู ุฑุงูโุงูุฏุงุฒ](#ูุตุจ-ู-ุฑุงูุงูุฏุงุฒ)
- [ุงุณุชูุงุฏู](#ุงุณุชูุงุฏู)
- [API Endpoints](#api-endpoints)
- [ุงููุช](#ุงููุช)
- [ุนุจโุงุจ](#ุนุจุงุจ)

## ๐ฏ ูุนุฑู

ุณุณุชู ุงุญุฑุงุฒ ููุช ุฏู ูุฑุญููโุง (Two-Factor Authentication) ฺฉ ูุงู ุงููุช ุงุถุงู ุจุฑุง ูุญุงูุธุช ุงุฒ ุญุณุงุจโูุง ฺฉุงุฑุจุฑ ุงุณุช. ุงู ุณุณุชู ุนูุงูู ุจุฑ ุฑูุฒ ุนุจูุฑุ ุงุฒ ฺฉุฏ 6 ุฑูู ุงุฑุณุงู ุดุฏู ุจู ุงูู ฺฉุงุฑุจุฑ ูุฒ ุงุณุชูุงุฏู ูโฺฉูุฏ.

## โจ ูฺฺฏโูุง

- **ฺฉุฏ 6 ุฑูู**: ุชููุฏ ฺฉุฏ ุชุตุงุฏู 6 ุฑูู
- **ุงุฑุณุงู ุงูู**: ุงุฑุณุงู ฺฉุฏ ุจู ุงูู ฺฉุงุฑุจุฑ
- **ุฒูุงู ุงููุถุง**: ฺฉุฏ ุชุง 5 ุฏููู ูุนุชุจุฑ ุงุณุช
- **ุงุฑุณุงู ูุฌุฏุฏ**: ุงูฺฉุงู ุงุฑุณุงู ูุฌุฏุฏ ฺฉุฏ
- **ูุนุงู/ุบุฑูุนุงู**: ุงูฺฉุงู ูุนุงู ุง ุบุฑูุนุงู ฺฉุฑุฏู 2FA
- **ุฑุงุจุท ฺฉุงุฑุจุฑ**: ูุฑู ุฒุจุง ู ฺฉุงุฑุจุฑูพุณูุฏ
- **ุงููุช ุจุงูุง**: ูุญุงูุธุช ุฏุฑ ุจุฑุงุจุฑ ุญููุงุช brute force

## ๐ ูุญูู ฺฉุงุฑ

### 1. ูุฑุขูุฏ ูุฑูุฏ ุจุง 2FA
```
ฺฉุงุฑุจุฑ โ ูุฑูุฏ ุงูู/ุฑูุฒ โ ุจุฑุฑุณ 2FA โ ุงุฑุณุงู ฺฉุฏ โ ุชุงุฏ ฺฉุฏ โ ูุฑูุฏ ูููู
```

### 2. ูุฑุขูุฏ ูุนุงูโุณุงุฒ 2FA
```
ฺฉุงุฑุจุฑ โ ูพุฑููุงู โ ูุนุงูโุณุงุฒ 2FA โ ุชุงุฏ ุฑูุฒ โ ูุนุงู ุดุฏู
```

## ๐ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### 1. ูุตุจ Dependencies
```bash
npm install nodemailer
```

### 2. ุชูุธูุงุช ุงูู
ุฏุฑ ูุงู `.env` ุง ูุชุบุฑูุง ูุญุท:

```env
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
JWT_SECRET=your-secret-key
```

### 3. ุชูุธูุงุช Gmail
ุจุฑุง ุงุณุชูุงุฏู ุงุฒ Gmail:
1. ูุนุงู ฺฉุฑุฏู Two-Factor Authentication ุฏุฑ Gmail
2. ุงุฌุงุฏ App Password
3. ุงุณุชูุงุฏู ุงุฒ App Password ุฏุฑ EMAIL_PASS

### 4. ุฑุงูโุงูุฏุงุฒ ุฏุชุงุจุณ
ุณุชูู `twoFactorEnabled` ุจู ุฌุฏูู `users` ุงุถุงูู ูโุดูุฏ:

```sql
ALTER TABLE users ADD COLUMN twoFactorEnabled INTEGER DEFAULT 0;
```

## ๐ฑ ุงุณุชูุงุฏู

### 1. ูุฑูุฏ ฺฉุงุฑุจุฑ
```javascript
// ูุฑุญูู 1: ูุฑูุฏ ุจุง ุงูู ู ุฑูุฒ
const loginResponse = await fetch('/api/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
});

const loginData = await loginResponse.json();

if (loginData.requires2FA) {
    // ูุฑุญูู 2: ุชุงุฏ ฺฉุฏ 2FA
    const verifyResponse = await fetch('/api/verify-2fa', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            code: '123456', 
            tempToken: loginData.tempToken 
        })
    });
}
```

### 2. ูุนุงูโุณุงุฒ 2FA
```javascript
const response = await fetch('/api/profile/toggle-2fa', {
    method: 'POST',
    headers: { 
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({ enable: true, password: 'userPassword' })
});
```

### 3. ุงุฑุณุงู ูุฌุฏุฏ ฺฉุฏ
```javascript
const response = await fetch('/api/resend-2fa', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ tempToken })
});
```

## ๐ API Endpoints

### POST /api/login
ูุฑูุฏ ฺฉุงุฑุจุฑ ู ุจุฑุฑุณ ูุงุฒ ุจู 2FA

**Request:**
```json
{
    "email": "user@example.com",
    "password": "userPassword"
}
```

**Response (ุจุฏูู 2FA):**
```json
{
    "success": true,
    "token": "jwt_token",
    "requires2FA": false
}
```

**Response (ุจุง 2FA):**
```json
{
    "success": true,
    "requires2FA": true,
    "message": "ฺฉุฏ ุงุญุฑุงุฒ ููุช ุจู ุงูู ุดูุง ุงุฑุณุงู ุดุฏ",
    "tempToken": "temporary_jwt_token"
}
```

### POST /api/verify-2fa
ุชุงุฏ ฺฉุฏ 2FA

**Request:**
```json
{
    "code": "123456",
    "tempToken": "temporary_jwt_token"
}
```

**Response:**
```json
{
    "success": true,
    "token": "final_jwt_token",
    "message": "ุงุญุฑุงุฒ ููุช ููููุชโุขูุฒ ุจูุฏ"
}
```

### POST /api/resend-2fa
ุงุฑุณุงู ูุฌุฏุฏ ฺฉุฏ 2FA

**Request:**
```json
{
    "tempToken": "temporary_jwt_token"
}
```

**Response:**
```json
{
    "success": true,
    "message": "ฺฉุฏ ุฌุฏุฏ ุงุฑุณุงู ุดุฏ"
}
```

### POST /api/profile/toggle-2fa
ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู 2FA

**Request:**
```json
{
    "enable": true,
    "password": "userPassword"
}
```

**Response:**
```json
{
    "success": true,
    "message": "ุงุญุฑุงุฒ ููุช ุฏู ูุฑุญููโุง ูุนุงู ุดุฏ",
    "twoFactorEnabled": true
}
```

## ๐ ุงููุช

### 1. ูุญุงูุธุชโูุง ุงููุช
- **ฺฉุฏ ูููุช**: ฺฉุฏูุง ุฏุฑ ุญุงูุธู ูููุช ุฐุฎุฑู ูโุดููุฏ
- **ุฒูุงู ุงููุถุง**: ฺฉุฏูุง ูพุณ ุงุฒ 5 ุฏููู ูููุถ ูโุดููุฏ
- **ุชูฺฉู ูููุช**: ุงุณุชูุงุฏู ุงุฒ JWT ูููุช ุจุฑุง ูุฑุญูู ุฏูู
- **Rate Limiting**: ูุญุฏูุฏุช ุงุฑุณุงู ฺฉุฏ
- **Brute Force Protection**: ูุญุงูุธุช ุฏุฑ ุจุฑุงุจุฑ ุญููุงุช

### 2. ุจูุชุฑู ุดููโูุง
- ุงุณุชูุงุฏู ุงุฒ App Password ุจุฑุง Gmail
- ุชุบุฑ JWT_SECRET ุฏุฑ ูุญุท production
- ุงุณุชูุงุฏู ุงุฒ HTTPS ุฏุฑ production
- ูุงฺฏ ฺฉุฑุฏู ูุนุงูุชโูุง ูุดฺฉูฺฉ

### 3. ูุญุฏูุฏุชโูุง
- ุญุฏุงฺฉุซุฑ 5 ุชูุงุด ูุฑูุฏ ุฏุฑ 15 ุฏููู
- ฺฉุฏ 6 ุฑูู ููุท ุดุงูู ุงุนุฏุงุฏ
- ุฒูุงู ุงููุถุง 5 ุฏูููโุง

## ๐๏ธ ุนุจโุงุจ

### ูุดฺฉูุงุช ุฑุงุฌ

#### 1. ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงูู
```
ุฎุทุง: ุฎุทุง ุฏุฑ ุงุฑุณุงู ฺฉุฏ ุงุญุฑุงุฒ ููุช
ุฑุงูโุญู: ุจุฑุฑุณ ุชูุธูุงุช EMAIL_USER ู EMAIL_PASS
```

#### 2. ฺฉุฏ ูููุถ ุดุฏู
```
ุฎุทุง: ฺฉุฏ ูุงูุนุชุจุฑ ุง ูููุถ ุดุฏู ุงุณุช
ุฑุงูโุญู: ุงุณุชูุงุฏู ุงุฒ ุฏฺฉูู "ุงุฑุณุงู ูุฌุฏุฏ ฺฉุฏ"
```

#### 3. ุฎุทุง Gmail
```
ุฎุทุง: Authentication failed
ุฑุงูโุญู: ุงุณุชูุงุฏู ุงุฒ App Password ุจู ุฌุง ุฑูุฒ ุงุตู
```

### ูุงฺฏโูุง ููุฏ
```javascript
// ูุงฺฏ ฺฉุฑุฏู ุงุฑุณุงู ฺฉุฏ
console.log(`๐ง 2FA code sent to ${email}: ${code}`);

// ูุงฺฏ ฺฉุฑุฏู ุชุงุฏ ฺฉุฏ
console.log(`โ 2FA verification successful for user ${userId}`);

// ูุงฺฏ ฺฉุฑุฏู ุฎุทุงูุง
console.error('โ 2FA email sending failed:', error);
```

## ๐ ุขูุงุฑ ู ูุงูุชูุฑูฺฏ

### ูุชุบุฑูุง ูุงุจู ุฑุฏุงุจ
- ุชุนุฏุงุฏ ฺฉุฏูุง ุงุฑุณุงู ุดุฏู
- ูุฑุฎ ููููุช ุชุงุฏ ฺฉุฏ
- ุชุนุฏุงุฏ ุชูุงุดโูุง ูุงูููู
- ุฒูุงู ูุชูุณุท ุชุงุฏ

### ูุซุงู ฺฉุฏ ูุงูุชูุฑูฺฏ
```javascript
// ุฑุฏุงุจ ุขูุงุฑ 2FA
const twoFactorStats = {
    codesSent: 0,
    codesVerified: 0,
    failedAttempts: 0,
    averageVerificationTime: 0
};
```

## ๐ ุจูโุฑูุฒุฑุณุงูโูุง ุขูุฏู

### ูฺฺฏโูุง ูพุดููุงุฏ
- **SMS 2FA**: ุงุฑุณุงู ฺฉุฏ ุจู ุดูุงุฑู ุชููู
- **Authenticator Apps**: ูพุดุชุจุงู ุงุฒ Google Authenticator
- **Backup Codes**: ฺฉุฏูุง ูพุดุชุจุงู
- **Remember Device**: ุจู ุฎุงุทุฑ ุณูพุฑุฏู ุฏุณุชฺฏุงู
- **Multiple Methods**: ฺูุฏู ุฑูุด ุงุญุฑุงุฒ ููุช

### ุจูุจูุฏูุง ุงููุช
- **Hardware Tokens**: ูพุดุชุจุงู ุงุฒ ุชูฺฉูโูุง ุณุฎุชโุงูุฒุงุฑ
- **Biometric**: ุงุญุฑุงุฒ ููุช ุจููุชุฑฺฉ
- **Risk-Based**: ุงุญุฑุงุฒ ููุช ุจุฑ ุงุณุงุณ ุฑุณฺฉ
- **Device Fingerprinting**: ุดูุงุณุง ุฏุณุชฺฏุงู

## ๐ ูพุดุชุจุงู

ุจุฑุง ุณูุงูุงุช ู ูุดฺฉูุงุช:
1. ุจุฑุฑุณ ูุงฺฏโูุง ุณุฑูุฑ
2. ุชุณุช ุชูุธูุงุช ุงูู
3. ุจุฑุฑุณ ูุชุบุฑูุง ูุญุท
4. ูุฑุงุฌุนู ุจู ูุณุชูุฏุงุช API

---

**ูฺฉุชู**: ุงู ุณุณุชู ุจุฑุง ูุญุทโูุง production ูุงุฒ ุจู ุชูุธูุงุช ุงุถุงู ุงููุช ุฏุงุฑุฏ. 