<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اعلان‌های من</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .notif-card { max-width: 700px; margin: 40px auto; }
        .notif-unread { background: #e3f2fd; }
    </style>
</head>
<body>
    <div class="container">
        <div class="notif-card card shadow">
            <div class="card-header text-center">
                <h3><i class="fas fa-bell me-2"></i>اعلان‌های من</h3>
            </div>
            <div class="card-body" id="notifList">
                <div class="text-center text-muted">در حال بارگذاری...</div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const token = localStorage.getItem('authToken');
        if (!token) {
            document.body.innerHTML = '<div class="container mt-5"><div class="alert alert-danger">برای مشاهده اعلان‌ها ابتدا وارد شوید.</div></div>';
            return;
        }
        await loadNotifications();
        async function loadNotifications() {
            const res = await fetch('/api/notifications', { headers: { 'Authorization': `Bearer ${token}` } });
            const data = await res.json();
            const container = document.getElementById('notifList');
            if (!data.success || !data.notifications.length) {
                container.innerHTML = '<div class="text-center text-muted">اعلانی وجود ندارد.</div>';
                return;
            }
            container.innerHTML = data.notifications.map(n => `
                <div class="mb-3 p-3 border rounded d-flex align-items-center ${n.read ? '' : 'notif-unread'}">
                    <div class="flex-grow-1">
                        <b>${n.title}</b>
                        <div class="text-muted small mb-1">${n.createdAt ? new Date(n.createdAt).toLocaleString('fa-IR') : ''}</div>
                        <div>${n.message}</div>
                    </div>
                    <div class="ms-2 d-flex flex-column align-items-end">
                        ${n.read ? '' : `<button class="btn btn-sm btn-outline-success mb-1" onclick="markRead(${n.id})"><i class="fas fa-check"></i></button>`}
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteNotif(${n.id})"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }
        window.markRead = async function(id) {
            await fetch(`/api/notifications/${id}/read`, { method: 'POST', headers: { 'Authorization': `Bearer ${token}` } });
            loadNotifications();
        };
        window.deleteNotif = async function(id) {
            if (!confirm('حذف این اعلان؟')) return;
            await fetch(`/api/notifications/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
            loadNotifications();
        };
    });
    </script>
</body>
</html> 